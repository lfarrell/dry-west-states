d3.csv("data/all_2000.csv",function(g){function v(a,c,g){return d3.scale.quantize().domain(d3.extent(c,\u0192(g))).range(a)}function y(a){switch(a){case "01":return"January";case "02":return"February";case "03":return"March";case "04":return"April";case "05":return"May";case "06":return"June";case "07":return"July";case "08":return"August";case "09":return"September";case "10":return"October";case "11":return"November";case "12":return"December";default:return"unknown"}}var k=d3.time.format("%m/%Y").parse,
    E=d3.time.format("%Y").parse,z="#543005 #8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" "),A="#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" ").reverse(),w=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);g.forEach(function(a){a.date=k(a.month+"/"+a.year);a.value=+a.value;a.anomaly=+a.anomaly;a.string_year=a.year;a.year=E(a.year)});localStorage.setItem("state","CA");var r=d3.select("#drought_div").append("svg"),
    t=d3.select("#precip_div").append("svg"),B=d3.select("#temp_div").append("svg"),n=_.debounce(function(){function a(a,e,d){var g=v(z,a,"value"),q=v(A,a,"anomaly"),n=/temp/.test(d),x;e.attr("width",c+95+105).attr("height",600);var u=d3.time.scale().range([0,c]);u.domain(d3.extent(a,\u0192("year")));var h=_.pluck(_.uniq(a,function(b){return b.month}),"month"),k=d3.scale.ordinal().rangeRoundBands([0,555],.05);k.domain(h);var h=d3.svg.axis().scale(u).orient("top").ticks(f).tickFormat(function(b){b=/\d{4}/.exec(b.toString());
        return 15<=f?b[0]:3<=f?b[0].substr(2,4):b[0]}),r=d3.svg.axis().scale(u).orient("bottom").ticks(f),t=d3.svg.axis().scale(k).orient("left");e.append("g").attr("class","x axis").translate([95,20]);d3.select(d+" g.x").call(h);e.append("g").attr("class","x bottom axis").translate([95,575]);d3.select(d+" g.bottom").call(r);e.append("g").attr("class","y axis").translate([70,20]);d3.select(d+" g.y").call(t);d3.selectAll(d+" g.y text").text(function(b){return y(d3.select(this).text())});x=/precip/.test(d)?
        " inches":/temp/.test(d)?" degrees":"";e=e.selectAll("circle").data(a);e.enter().append("circle");e.attr("cx",function(b){return u(b.year)}).attr("cy",function(b){return k(b.month)}).attr("r",l).translate([95,45]).style("fill",function(b){return n?q(b.anomaly):g(b.value)}).on("mouseover touchstart",function(b){w.transition().duration(100).style("opacity",.9);w.html('<h4 class="text-center">'+y(b.month)+" "+b.string_year+'</h4><ul class="list-unstyled"<li>State: '+b.state+"</li><li>Value: "+b.value+
        x+"</li><li>Departure from Avg: "+b.anomaly+x+"</li></ul>").style("top",d3.event.pageY-108+"px").style("left",d3.event.pageX-28+"px")}).on("mouseout touchend",function(b){w.transition().duration(250).style("opacity",0)});e.exit().remove();(function(b,a,d,c){d3.select(b+" .legend").remove();var e=/temp/.test(b)?"anomaly":"value";d=v(a,d,e);a=b.substr(1);b=d3.select(b).append("svg").classed("svg",!0).classed("legend",!0);b.attr("width",c+120).attr("height",C);b.append("g").attr("class","legend-"+a).attr("width",
        c).translate([95,20]);c=d3.legend.color().shapeWidth(m).orient(p).labelFormat(d3.format(D)).scale(d);b.select(".legend-"+a).call(c);return b})(d,n?A:z,a,c)}var c=window.innerWidth-105-95,h=localStorage.getItem("state","CA"),q=g.filter(function(a){return"drought"===a.type&&a.state===h}),n=g.filter(function(a){return"precip"===a.type&&a.state===h}),k=g.filter(function(a){return"temp"===a.type&&a.state===h}),l,f,m,p,C,D;d3.select("#state").on("change",function(){var c=this.options[this.selectedIndex].innerHTML,
        e=d3.select(this),d=e.prop("value"),f=g.filter(function(a){return"drought"===a.type&&a.state===d}),h=g.filter(function(a){return"precip"===a.type&&a.state===d}),k=g.filter(function(a){return"temp"===a.type&&a.state===d});d3.selectAll(".selected_state").text(c);e.prop("value","");localStorage.setItem("state",d);a(f,r,"#drought_div");a(h,t,"#precip_div");a(k,B,"#temp_div")});150>c?(f=l=3,m=10,p="vertical"):350>c?(l=6,f=9,m=20,p="vertical"):500>c?(f=l=9,m=40,p="vertical"):(700>c?(l=11,f=9,m=50):1E3>
        c?(l=16,f=17,m=65):(l=20,f=17,m=70),p="horizontal");C=800<=c?150:275;D=900>c&&"horizontal"===p?"0f":".02f";a(q,r,"#drought_div");a(n,t,"#precip_div");a(k,B,"#temp_div");q=d3.selectAll(".row");q.classed("opaque",!1);q.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)},200);n();window.addEventListener("resize",n)});